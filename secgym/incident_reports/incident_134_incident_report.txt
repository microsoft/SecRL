Title: Multi-Stage Business Email Compromise via Malicious URL, Unauthorized Sign‐Ins & Password Spray

────────────────────────────
EXECUTIVE SUMMARY
────────────────────────────
On July 17–18, 2024, a coordinated multi-stage attack was detected and investigated. The attack began with a user clicking on a malicious URL embedded in an email, which initiated a cascade of events including anonymous and malicious IP sign‐ins, suspicious email inbox rule manipulations, and ultimately, business email compromise (BEC) activities. Later, a password spray attack led to a compromised user account. The attacker exploited vulnerabilities in email delivery and identity protection systems, using methods such as phishing and credential attacks, to gain unauthorized access, manipulate inbox settings, and exfiltrate sensitive messages. Prompt detection and response were triggered by alerts across Office 365 Advanced Threat Protection, Azure Active Directory Identity Protection, and Microsoft 365 Defender.

────────────────────────────
INCIDENT TIMELINE
────────────────────────────
• 2024-07-17 10:50:25 UTC – Alert Node 0 (“A potentially malicious URL click was detected”) is generated after a user interaction with a known malicious URL, indicating initial exposure.
  
• 2024-07-17 10:56:50 UTC – Alert Node 11 (“Anonymous IP address”) records a sign-in from an anonymized IP (170.54.121.63) likely used to mask attacker identity.
  
• 2024-07-17 10:49–10:51 UTC – Alert Node 13 (“Email messages containing malicious URL removed after delivery”) logs emails harbouring the malicious URL. Email content was delivered and later quarantined.
  
• 2024-07-17 11:06:04 UTC – Alert Nodes 14 (“Suspicious inbox manipulation rule”) and 17 (“BEC financial fraud”) are triggered. These alerts signal that the attacker is adjusting mailbox rules to hide incoming messages and potentially facilitate data exfiltration and fraudulent financial communications.
  
• 2024-07-17 11:06:54 UTC – Alert Node 18 (“Suspicious emails sent by BEC-related user”) is raised when suspicious outbound emails hinting at BEC fraud are detected.
  
• 2024-07-17 13:48:02 UTC – Alert Node 23 (“Malicious IP address”) confirms additional sign-in activity from the known-malicious IP tied to earlier events, reinforcing the suspicion of external compromise.
  
• 2024-07-18 14:36:59 UTC – Alert Node 24 (“Password Spray”) documents a credential attack where a series of common passwords were attempted across multiple accounts.
  
• 2024-07-18 14:54:18 UTC – Alert Node 25 (“Account compromised following a password-spray attack”) confirms that a user account (raphaelt@vnevado.alpineskihouse.co) was accessed from an unusual location and browser, consolidating evidence of compromise.

────────────────────────────
TECHNICAL ANALYSIS
────────────────────────────
1. Initial Phishing & Malicious URL (Node 0):
   • A malicious URL was clicked by a user (raphaelt@vnevado.alpineskihouse.co). 
   • The embedded URL (nodes 5 and 10) points to a suspicious Azure Container App instance which could be hosting exploit code or phishing content.
   • Techniques referenced: T1566 (phishing) and its subtechnique T1566.002.

2. Anonymous & Malicious Sign-ins (Nodes 11, 12, 23):
   • Anonymous IP alert from IP 170.54.121.63 signified a login using anonymization tools.
   • This same IP later appears in a “Malicious IP address” alert, validating its reputation for undesirable behavior in sign-in attempts.
   • This is indicative of an initial access phase, where the attacker covers tracks by using anonymizer VPNs or Tor browsers.

3. Email Delivery and Quarantine (Node 13):
   • Malicious emails containing the URL were initially delivered (mail exfiltration attempt) and later removed.
   • These events indicate a failure in pre-delivery filtering and demonstrate an attempt to evade detection by initially allowing delivery then removing the content after initial spread.

4. Suspicious Inbox Manipulation & BEC Activity (Nodes 14, 17, 18):
   • The “Suspicious inbox manipulation rule” alert points to unauthorized changes to mailbox rules.
   • The creation of these rules was likely designed to hide legitimate emails or redirect communications, facilitating the BEC financial fraud attack.
   • Alert Node 17 ("BEC financial fraud") confirms further that the attacker was attempting to hide incoming emails, a common indicator of BEC.
   • Alert Node 18 shows outbound suspicious emails being sent from the compromised account to an unusual recipient (Nathan@avoriaz.alpineskihouse.co). This represents lateral movement and active exploitation of the compromised email system.

5. Password Spray & Account Compromise (Nodes 24, 25):
   • Alert Node 24 flagged a password spray attack; multiple accounts were targeted using common passwords.
   • The final alert (Node 25) proves that post-spray, the attacker successfully logged in from an unusual location/browser. This confirmed compromise of the target account (raphaelt@vnevado.alpineskihouse.co) and correlates strongly with the account’s subsequent suspicious activity.
  
Interrelationships:
   • Graph edges show that the initial malicious URL (Node 0) is tightly coupled with subsequent email delivery and manipulation events (Node 13), pointing to a chain reaction.
   • The compromised account entity (associated with “Nina Park” and "raphaelt@vnevado.alpineskihouse.co" from Nodes 4, 6, 7, 8, 9) links directly to inbox manipulation (Node 14), BEC-related financial fraud (Node 17), and suspicious sending behavior (Node 18).
   • IP-centric alerts (Nodes 11, 12, 23, 24, 25) are interconnected, suggesting that the same external malicious infrastructure was used in both initial access and subsequent password spray actions.

────────────────────────────
AFFECTED ENTITIES
────────────────────────────
• User Accounts:
   – raphaelt@vnevado.alpineskihouse.co (compromised mailbox)
   – Associated account details linked to “Nina Park” (with identifiers such as Sid S-1-5-21-1874151667-3554330288-105586563-1715 and AadUserId e036dee7-fa23-42ef-a019-468c8d3401f1).

• Mail Messages:
   – Malicious email messages initially delivered (referenced in Node 13) 
   – Suspicious emails sent to Nathan@avoriaz.alpineskihouse.co (Nodes 18, 20, 21, 22)

• Network/IP addresses:
   – 170.54.121.63 (Anonymous/Malicious IP used for sign-ins and password spray)
   – 237.7.81.122 (Attacker IP implicated in inbox rule manipulations and outbound emails)

• Cloud Applications:
   – Microsoft Exchange Online (Node 15 via cloud-application involvement)

────────────────────────────
A